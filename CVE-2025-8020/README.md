# SSRF Bypass in `private-ip` (CVE-2025-8020)

**Initially Found by: Liran Tal : https://lirantal.com/**

---

## 1. Vulnerability Overview

The `private-ip` npm package, designed to check if an IP address is private, is susceptible to a **Server-Side Request Forgery (SSRF) bypass**. This happens because the package's internal list of private IP ranges, its allowlist, is incomplete. Specifically, it's missing the **multicast IP address space (`224.0.0.0/4`)**.

An attacker can exploit this by providing an IP address or hostname that resolves to a multicast IP. Since `private-ip` doesn't correctly identify multicast addresses as "private" (in the context of being restricted from external access in typical network setups), an application relying on this package for SSRF protection could be tricked into making requests to internal or otherwise restricted multicast resources.

While attacks on multicast IPs often involve UDP protocols (given their common use in service discovery, streaming, and network management protocols like SSDP or mDNS), the ability to make *any* request to an internal network segment via SSRF is a significant security flaw. This could lead to **information disclosure**, **port scanning** of internal services, or interaction with misconfigured internal applications.

---

## 2. Root Cause Analysis

The heart of the vulnerability lies in the `PRIVATE_IP_RANGES` array within the `private-ip` package's source code. This array is meant to define all IP address ranges considered "private" or internal, which applications typically block as part of SSRF prevention. However, it completely **omits the multicast address range `224.0.0.0/4`**.

Multicast addresses are used for one-to-many communication within a network. Though not "private" in the same way as RFC1918 addresses (like 10.0.0.0/8 or 192.168.0.0/16), they are generally not routable on the public internet and are often used for internal network services.

When an application uses `private-ip` to validate URLs or IP addresses before making server-side requests, and an attacker supplies a multicast IP, `private-ip` incorrectly returns `false` (meaning it's *not* a private IP). This allows the application to proceed with the request, potentially reaching internal multicast services or devices that should remain isolated. Because multicast often operates over UDP, an attacker can specifically interact with UDP-based services.

---

## 3. Proof of Concept (PoC)

A dedicated lab environment has been set up to demonstrate this SSRF bypass. This setup typically includes:

1.  **A Vulnerable Application:** An application that relies on the `private-ip` npm package for IP address validation before initiating server-side requests.
2.  **An Internal Network Segment:** This segment hosts a device or service listening on a multicast IP address and a specific UDP port. For instance, a service might be listening on `239.255.255.250` on UDP port `1900` (a common port for SSDP).

**Demonstration Steps (Conceptual):**

1.  **Attacker Input:** The attacker provides a URL or IP address that resolves to a multicast IP, such as `239.255.255.250:1900`.
2.  **Vulnerable Application Processing:** The vulnerable application receives this input and passes the IP `239.255.255.250` to the `private-ip` package for validation.
3.  **`private-ip` Inaccuracy:** Due to the missing multicast range in its allowlist, `private-ip` returns `false`, incorrectly indicating that `239.255.255.250` is *not* a private IP.
4.  **SSRF Execution:** The application, mistakenly believing the IP is safe, proceeds to make a server-side request (e.g., a UDP request) to `239.255.255.250` on port `1900`.
5.  **Impact:** This request successfully reaches the internal multicast service, potentially allowing the attacker to:
    * **Discover internal services** (e.g., by analyzing SSDP responses).
    * **Trigger actions** on devices (if the service accepts commands).
    * **Exfiltrate information** if the service responds with sensitive data.
    * **Identify open UDP ports** on internal devices.

The success of the PoC can be confirmed by observing network traffic or examining the logs of the internal multicast service, verifying that a request originated from the vulnerable application's server.

---

## 4. Mitigation and Remediation

No fix has been issues by the package owner.
